name: sam2-test

resources:
  accelerators: T4:1
  use_spot: true  # Use on-demand for testing (more reliable)
  disk_size: 100
  ports: 8080
  image_id: docker:choprahetarth/sam2-server:latest
  any_of:
    - infra: aws/us-east-1
    - infra: aws/us-west-2
    - infra: aws/us-west-1
    - infra: aws/us-east-2
    - infra: aws/eu-central-1
    - infra: aws/eu-west-1
    - infra: aws/eu-west-2
    - infra: aws/ap-northeast-1
    - infra: aws/ap-southeast-1
    - infra: aws/ap-southeast-2
    - infra: aws/ap-northeast-2
    - infra: vast


setup: |
  echo "Using pre-built Docker image choprahetarth/sam2-server"
  echo "No installation required - cold start will be FAST!"
  # docker pull choprahetarth/sam2-server:latest


run: |
  echo "Docker container starting SAM2 server..."
  cd /app
  # python3 SAM_2_server.py --port 8080 --host 0.0.0.0
  # gunicorn SAM_2_server:app --bind 0.0.0.0:8080 --workers 1
  # gunicorn SAM_2_server:app --bind 0.0.0.0:8080 --workers 5 --worker-class gevent --worker-connections 100 --timeout 120
  gunicorn SAM_2_server:app   --bind 0.0.0.0:8080   --workers 5   --threads 8   --timeout 120
